<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | MoneyTracker</title>
    <link rel="stylesheet" href="/static/login.css">
    <link rel="stylesheet" href="/static/navbar.css">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* Hide the specific success message shown in the screenshot */
        div.wrapper > div[style*="background-color"],
        div.wrapper > div.alert:not(#flash-messages .alert),
        div.wrapper > div:nth-child(1):not(#flash-messages) {
            display: none !important;
        }
        
        /* Hide any static success messages that might be hard-coded or injected */
        [style*="background-color: rgb(223, 240, 216)"],
        [style*="background-color: #dff0d8"],
        [style*="Login successful!"] {
            display: none !important;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            position: relative;
            transition: opacity 0.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .alert-success {
            background-color: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .alert-error {
            background-color: rgba(249, 65, 68, 0.1);
            color: #f94144;
            border: 1px solid rgba(249, 65, 68, 0.3);
        }
        .alert-icon {
            margin-right: 10px;
            font-size: 18px;
        }
        .alert-close {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: inherit;
            opacity: 0.7;
        }
        .alert-close:hover {
            opacity: 1;
        }
    </style>
    <!-- Script to remove any cached or static success messages -->
    <script>
        // Execute immediately to prevent flash of unwanted content
        (function() {
            // Remove any cached success messages stored in localStorage
            if (window.localStorage) {
                localStorage.removeItem('loginSuccess');
                localStorage.removeItem('showSuccessMessage');
            }
        })();
        
        // Use MutationObserver to catch and remove unwanted success messages
        document.addEventListener('DOMContentLoaded', function() {
            // First remove any static success message that might be already in the DOM
            removeUnwantedMessages();
            
            // Then set up observer to catch any that might be added dynamically
            const observer = new MutationObserver(function(mutations) {
                removeUnwantedMessages();
            });
            
            // Start observing the document for added nodes
            observer.observe(document.body, { childList: true, subtree: true });
            
            function removeUnwantedMessages() {
                // Look for any elements containing "Login successful!" text
                const allElements = document.querySelectorAll('div, p, span');
                allElements.forEach(function(el) {
                    if (el.innerText && el.innerText.includes('Login successful!')) {
                        // Don't hide legitimate flash messages in our container
                        if (!el.closest('#flash-messages')) {
                            el.style.display = 'none';
                        }
                    }
                });
                
                // Look for light green success message boxes
                const allDivs = document.querySelectorAll('div');
                allDivs.forEach(function(div) {
                    // Skip our legitimate flash messages
                    if (div.closest('#flash-messages')) return;
                    
                    const style = window.getComputedStyle(div);
                    const bgColor = style.backgroundColor;
                    
                    // Check for light green backgrounds (typical success message color)
                    if (bgColor.includes('rgb(223, 240, 216)') || 
                        bgColor.includes('rgb(212, 237, 218)') ||
                        bgColor.includes('rgba(223, 240, 216') ||
                        bgColor.includes('rgba(212, 237, 218')) {
                        div.style.display = 'none';
                    }
                });
            }
        });
    </script>
</head>
<body>
    <nav>
        <div class="logo-container">
            <img class="logo" src="/static/images/logo.png" alt="logo" />
        </div>
        <ul id="sidemenu" class="menu-list">
            <div class="icon cancel-btn">
                <i class="fa-solid fa-xmark"></i>
            </div>
            <li><a href="/">Home</a></li>
            <li><a href="/login.html" class="active">Sign up / Login</a></li>
        </ul>
        <div class="icon menu-btn">
            <i class="fa-solid fa-bars"></i>
        </div>
    </nav>
    <div class="container">
        <div class="wrapper">
            <div id="flash-messages">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}" id="alert-{{ loop.index }}">
                                <i class="alert-icon fas {% if category == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %}"></i>
                                {{ message }}
                                <span class="alert-close" onclick="closeAlert('alert-{{ loop.index }}')"><i class="fas fa-times"></i></span>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
            
            <!-- Login Form -->
            <form method="POST" action="{{ url_for('login') }}" id="login-form">
                <h2>Login</h2>
                <div class="input-field">
                    <input type="email" name="email" required>
                    <label>Enter your email</label>
                </div>
                <div class="input-field">
                    <input type="password" name="pwd" required>
                    <label>Enter your password</label>
                </div>
                <div class="forget">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" class="ui-checkbox">
                        <p>Remember me</p>
                    </div>
                    <a href="#">Forgot password?</a>
                </div>
                <button type="submit" name="submit">Log In</button>
                <p class="message">Not Registered? <a href="#register">Register</a></p>
            </form>

            <!-- Registration Form -->
            <form method="POST" action="{{ url_for('register') }}" id="registration-form">
                <h2>Register</h2>
                <div class="input-field">
                    <input type="text" name="name" required>
                    <label>Enter your name</label>
                </div>
                <div class="input-field">
                    <input type="email" name="email" required>
                    <label>Enter your email</label>
                </div>
                <div class="input-field">
                    <input type="password" name="pwd" required>
                    <label>Enter your password</label>
                </div>
                <button type="submit" name="submit">Register</button>
                <p class="message">Already Registered? <a href="#login">Login</a></p>
            </form>
        </div>
    </div>
    <footer>
        <p>Copyright 2025 - Money Tracker</p>
    </footer>
    <script src='https://code.jquery.com/jquery-3.2.1.min.js'></script>
    <script src="/static/navbar.js"></script>
    <script>
        // On page load, check for and remove any static success messages
        document.addEventListener('DOMContentLoaded', function() {
            // Look for any elements that might contain "Login successful" text
            const allElements = document.querySelectorAll('*');
            allElements.forEach(element => {
                if (element.innerText && element.innerText.includes('Login successful')) {
                    // Skip elements that are part of legitimate flash messages
                    if (!element.classList.contains('alert') && 
                        !element.closest('.alert') && 
                        !element.id.includes('flash')) {
                        element.style.display = 'none';
                    }
                }
            });
        });

        $('.message a').click(function() {
            $('form').animate({
                height: "toggle",
                opacity: "toggle"
            }, "slow");
        });
        
        // Auto-hide alert messages after 5 seconds
        window.onload = function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach((alert, index) => {
                setTimeout(() => {
                    alert.style.opacity = '0';
                    setTimeout(() => {
                        alert.style.display = 'none';
                    }, 500);
                }, 5000);
            });
        };
        
        // Function to close alert manually
        function closeAlert(alertId) {
            const alert = document.getElementById(alertId);
            if (alert) {
                alert.style.opacity = '0';
                setTimeout(() => {
                    alert.style.display = 'none';
                }, 500);
            }
        }
    </script>
</body>
</html>